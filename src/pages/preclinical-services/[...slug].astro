---
import { getAllHubPages, getAllParentPages, getAllServicePages } from '../../utils/dataLoader';
import HubPageLayout from '../../layouts/HubPageLayout.astro';
import ParentPageLayout from '../../layouts/ParentPageLayout.astro';
import ServicePageLayout from '../../layouts/ServicePageLayout.astro';

export async function getStaticPaths() {
  const hubPages = getAllHubPages();
  const parentPages = getAllParentPages();
  const servicePages = getAllServicePages();

  const paths = [
    ...hubPages.map(page => {
      // Hub pages: slug is just the hub name
      const slugPath = page.slug.replace(/^\/?preclinical-services\//, '').split('/').filter(Boolean);
      return {
        params: { slug: slugPath.join('/') },
        props: { page, pageType: 'hub' }
      };
    }),
    ...parentPages.map(page => {
      // Parent pages: construct full path from parentHubUrl + slug
      // e.g., /preclinical-services/cardiovascular-disease-testing/heart-valve-testing
      const hubPath = page.parentHubUrl.replace('/preclinical-services/', '');
      const fullPath = `${hubPath}/${page.slug}`;
      return {
        params: { slug: fullPath },
        props: { page, pageType: 'parent' }
      };
    }),
    ...servicePages.map(page => {
      // Service pages: use the full URL from parentHubUrl + slug
      // e.g., /preclinical-services/cardiovascular-disease-testing/heart-valve-testing/tavr-testing
      const parentPath = page.parentHubUrl.replace('/preclinical-services/', '');
      const fullPath = `${parentPath}/${page.slug}`;
      return {
        params: { slug: fullPath },
        props: { page, pageType: 'service' }
      };
    })
  ];

  return paths;
}

const { page, pageType } = Astro.props;
---

{pageType === 'hub' && <HubPageLayout page={page as any} />}
{pageType === 'parent' && <ParentPageLayout page={page as any} />}
{pageType === 'service' && <ServicePageLayout page={page as any} />}

