---
import BaseLayout from '../layouts/BaseLayout.astro';
import Button from '../components/ui/Button.astro';
---

<BaseLayout 
  title="Contact Us | Synchrony Labs"
  description="Get in touch with Synchrony Labs for expert preclinical research and testing services. Schedule a consultation for cardiovascular, neurovascular, and peripheral vascular device testing."
  url="/contact"
>
  <section class="relative pt-32 pb-12 md:pt-40 md:pb-16 flex flex-col items-center justify-center overflow-hidden">
    <div class="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center flex flex-col items-center">
      <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold tracking-tight text-center leading-[1.1] mb-6 text-navy dark:text-white">
        Contact Us
      </h1>
      <p class="max-w-2xl mx-auto text-lg sm:text-xl font-medium leading-relaxed mb-8 text-gray-600 dark:text-gray-400">
        Partner with Synchrony Labs for expert preclinical support and turn your medical device concepts into reality.
      </p>
      <div class="flex flex-col sm:flex-row items-center gap-4 sm:gap-8 text-lg font-medium text-navy dark:text-white">
        <div class="flex items-center gap-2">
          <span class="text-gray-600 dark:text-gray-400">Phone:</span>
          <span>919-541-9977 ext. 105</span>
        </div>
        <div class="hidden sm:block w-1.5 h-1.5 rounded-full bg-teal"></div>
        <div class="flex items-center gap-2">
          <span class="text-gray-600 dark:text-gray-400">Email:</span>
          <a href="mailto:sales@synchronylabs.com" class="hover:text-teal transition-colors">
            sales@synchronylabs.com
          </a>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 px-4 border-t border-navy/5 dark:border-white/5 bg-transparent">
    <div class="max-w-4xl mx-auto">
      <!-- Success Message -->
      <div id="success-message" class="hidden mb-8 p-4 rounded-md bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800">
        <p class="text-green-800 dark:text-green-200 font-medium">
          Thank you for your inquiry. We will get back to you soon!
        </p>
      </div>

      <!-- Error Message -->
      <div id="error-message" class="hidden mb-8 p-4 rounded-md bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800">
        <p id="error-text" class="text-red-800 dark:text-red-200 font-medium"></p>
      </div>

      <form class="space-y-8" id="contact-form">
        <!-- Honeypot field - hidden from users but visible to bots -->
        <div class="hidden" aria-hidden="true">
          <label for="website">Website (leave blank)</label>
          <input 
            type="text" 
            id="website" 
            name="website"
            tabindex="-1"
            autocomplete="off"
          />
        </div>

        <div class="space-y-2">
          <label for="name" class="block text-sm font-medium text-gray-600 dark:text-gray-400">
            Name
          </label>
          <input 
            type="text" 
            id="name" 
            name="name"
            required
            class="w-full px-4 py-3 rounded-md border border-navy/10 dark:border-white/10 bg-white dark:bg-navy-card text-navy dark:text-white focus:ring-2 focus:ring-teal focus:border-teal outline-none transition-all"
          />
        </div>

        <div class="space-y-2">
          <label for="email" class="block text-sm font-medium text-gray-600 dark:text-gray-400">
            Email
          </label>
          <input 
            type="email" 
            id="email" 
            name="email"
            required
            class="w-full px-4 py-3 rounded-md border border-navy/10 dark:border-white/10 bg-white dark:bg-navy-card text-navy dark:text-white focus:ring-2 focus:ring-teal focus:border-teal outline-none transition-all"
          />
        </div>

        <div class="space-y-2">
          <label for="phone" class="block text-sm font-medium text-gray-600 dark:text-gray-400">
            Phone
          </label>
          <input 
            type="tel" 
            id="phone" 
            name="phone"
            class="w-full px-4 py-3 rounded-md border border-navy/10 dark:border-white/10 bg-white dark:bg-navy-card text-navy dark:text-white focus:ring-2 focus:ring-teal focus:border-teal outline-none transition-all"
          />
        </div>

        <div class="space-y-2">
          <label for="company" class="block text-sm font-medium text-gray-600 dark:text-gray-400">
            Company
          </label>
          <input 
            type="text" 
            id="company" 
            name="company"
            class="w-full px-4 py-3 rounded-md border border-navy/10 dark:border-white/10 bg-white dark:bg-navy-card text-navy dark:text-white focus:ring-2 focus:ring-teal focus:border-teal outline-none transition-all"
          />
        </div>

        <div class="space-y-2">
          <label for="service" class="block text-sm font-medium text-gray-600 dark:text-gray-400">
            Device Type / Service Interest
          </label>
          <select 
            id="service" 
            name="service"
            class="w-full px-4 py-3 rounded-md border border-navy/10 dark:border-white/10 bg-white dark:bg-navy-card text-navy dark:text-white focus:ring-2 focus:ring-teal focus:border-teal outline-none transition-all"
          >
            <option value="">Select a service...</option>
            <option value="cardiovascular">Cardiovascular Testing</option>
            <option value="neurovascular">Neurovascular Testing</option>
            <option value="peripheral">Peripheral Vascular Testing</option>
            <option value="surgical-robotics">Surgical Robotics Testing</option>
            <option value="medical-device">Medical Device Testing</option>
            <option value="dcb">Drug-Coated Balloon Testing</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="space-y-2">
          <label for="message" class="block text-sm font-medium text-gray-600 dark:text-gray-400">
            Message
          </label>
          <textarea 
            id="message" 
            name="message"
            rows="6"
            required
            class="w-full px-4 py-3 rounded-md border border-navy/10 dark:border-white/10 bg-white dark:bg-navy-card text-navy dark:text-white focus:ring-2 focus:ring-teal focus:border-teal outline-none transition-all resize-y"
          ></textarea>
        </div>

        <div class="space-y-2">
          <label for="referral" class="block text-sm font-medium text-gray-600 dark:text-gray-400">
            How did you hear about us?
          </label>
          <input 
            type="text" 
            id="referral" 
            name="referral"
            class="w-full px-4 py-3 rounded-md border border-navy/10 dark:border-white/10 bg-white dark:bg-navy-card text-navy dark:text-white focus:ring-2 focus:ring-teal focus:border-teal outline-none transition-all"
          />
        </div>

        <div class="flex justify-center">
          <button
            type="submit"
            id="submit-button"
            class="inline-flex items-center justify-center h-14 px-8 text-lg rounded font-medium transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none active:scale-[0.98] bg-teal/90 text-white backdrop-blur-sm border border-white/10 shadow-[inset_0_1px_0_rgba(255,255,255,0.3),0_4px_20px_rgba(70,130,180,0.4)] hover:shadow-[inset_0_1px_0_rgba(255,255,255,0.4),0_6px_24px_rgba(70,130,180,0.6)] hover:bg-teal hover:-translate-y-0.5 relative overflow-hidden after:absolute after:inset-0 after:bg-gradient-to-b after:from-white/10 after:to-transparent"
          >
            <span id="submit-text">Submit</span>
            <span id="submit-spinner" class="hidden ml-2">
              <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </span>
          </button>
        </div>
      </form>
    </div>
  </section>
</BaseLayout>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitButton = document.getElementById('submit-button') as HTMLButtonElement;
  const submitText = document.getElementById('submit-text') as HTMLSpanElement;
  const submitSpinner = document.getElementById('submit-spinner') as HTMLSpanElement;
  const successMessage = document.getElementById('success-message') as HTMLDivElement;
  const errorMessage = document.getElementById('error-message') as HTMLDivElement;
  const errorText = document.getElementById('error-text') as HTMLParagraphElement;

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Hide previous messages
      successMessage.classList.add('hidden');
      errorMessage.classList.add('hidden');

      // Get form data
      const formData = new FormData(form);
      const data = {
        name: formData.get('name') as string,
        email: formData.get('email') as string,
        phone: formData.get('phone') as string || undefined,
        company: formData.get('company') as string || undefined,
        service: formData.get('service') as string || undefined,
        message: formData.get('message') as string,
        referral: formData.get('referral') as string || undefined,
        honeypot: formData.get('website') as string || undefined, // Honeypot field
      };

      // Client-side validation
      if (!data.name || !data.email || !data.message) {
        showError('Please fill in all required fields (Name, Email, and Message).');
        return;
      }

      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(data.email)) {
        showError('Please provide a valid email address.');
        return;
      }

      // Set loading state
      setLoading(true);

      try {
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (result.success) {
          // Show success message
          successMessage.classList.remove('hidden');
          form.reset();
          
          // Scroll to success message
          successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } else {
          // Show error message
          showError(result.error || 'Failed to send message. Please try again later.');
        }
      } catch (error) {
        console.error('Form submission error:', error);
        showError('An unexpected error occurred. Please try again later or contact us directly.');
      } finally {
        setLoading(false);
      }
    });
  }

  function setLoading(loading: boolean) {
    if (loading) {
      submitButton.disabled = true;
      submitText.textContent = 'Sending...';
      submitSpinner.classList.remove('hidden');
    } else {
      submitButton.disabled = false;
      submitText.textContent = 'Submit';
      submitSpinner.classList.add('hidden');
    }
  }

  function showError(message: string) {
    errorText.textContent = message;
    errorMessage.classList.remove('hidden');
    errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
</script>

