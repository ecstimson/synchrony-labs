---
import BaseLayout from './BaseLayout.astro';
import HeroWithPhoto from '../components/sections/HeroWithPhoto.astro';
import PrimaryContent from '../components/sections/PrimaryContent.astro';
import WhyChoose from '../components/sections/WhyChoose.astro';
import CTASection from '../components/sections/CTASection.astro';
import type { ServicePage } from '../types/index.js';
import { getBreadcrumbs } from '../utils/dataLoader';

interface Props {
  page: ServicePage;
}

// Map service page headlines to image paths
function getServiceHeroImage(headline: string, slug: string): string {
  const headlineLower = headline.toLowerCase();
  const slugLower = slug.toLowerCase();
  
  const imageMap: Record<string, string> = {
    // Heart Valve Services
    'tavr': '/images/services/Heart Valve Testing.jpg',
    'mitraclip': '/images/services/Heart Valve Testing.jpg',
    'sapien': '/images/services/Heart Valve Testing.jpg',
    'evolut': '/images/services/Heart Valve Testing.jpg',
    'pascal': '/images/services/Heart Valve Testing.jpg',
    'tendyne': '/images/services/Heart Valve Testing.jpg',
    'triclip': '/images/services/Heart Valve Testing.jpg',
    'corevalve': '/images/services/Heart Valve Testing.jpg',
    'heart valve': '/images/services/Heart Valve Testing.jpg',
    'pacemaker': '/images/services/Heart Valve Testing.jpg',
    'icd': '/images/services/Heart Valve Testing.jpg',
    'heart pump': '/images/services/Heart Valve Testing.jpg',
    'l vad': '/images/services/Heart Valve Testing.jpg',
    
    // Structural Heart Services
    'structural heart': '/images/services/Structural Heart Testing.jpg',
    'laa closure': '/images/services/Structural Heart Testing.jpg',
    'watchman': '/images/services/Structural Heart Testing.jpg',
    'renal denervation': '/images/services/Structural Heart Testing.jpg',
    
    // Coronary Stent Services
    'coronary stent': '/images/services/Coronary Stent Testing.jpg',
    'des testing': '/images/services/Coronary Stent Testing.jpg',
    'drug-eluting stent': '/images/services/Coronary Stent Testing.jpg',
    
    // Thrombectomy Services
    'thrombectomy': '/images/services/Thrombectomy Testing.jpg',
    'direct aspiration thrombectomy': '/images/services/Direct Aspiration Thrombectomy Testing.jpg',
    
    // Liquid Embolic Services
    'liquid embolic': '/images/services/Liquid Embolic Device Testing.jpg',
    'liquid embolic device': '/images/services/Liquid Embolic Device Testing.jpg',
    
    // Carotid Services
    'carotid stent': '/images/services/Carotid Stent Testing.jpg',
    'carotid': '/images/services/Carotid Stent Testing.jpg',
    
    // AAA Services
    'aaa device': '/images/services/AAA Device Testing.jpg',
    'aaa': '/images/services/AAA Device Testing.jpg',
    'aneurysm': '/images/services/AAA Device Testing.jpg',
    
    // IVC Filter Services
    'ivc filter': '/images/services/IVC Filter Testing.jpg',
    'ivc': '/images/services/IVC Filter Testing.jpg',
    
    // Endoscopic Services
    'endoscopic device': '/images/services/Endoscopic Device Testing.jpg',
    'endoscopic': '/images/services/Endoscopic Device Testing.jpg',
    
    // Laparoscopic Services
    'laparoscopic': '/images/services/Laparoscopic Testing.jpg',
    'laparoscopic testing': '/images/services/Laparoscopic Testing.jpg',
    
    // GLP Services
    'glp testing': '/images/services/GLP Testing.jpg',
    'glp': '/images/services/GLP Testing.jpg',
    
    // Biocompatibility Services
    'biocompatibility': '/images/services/Biocompatibility Testing.jpg',
    'biocompatibility testing': '/images/services/Biocompatibility Testing.jpg',
    
    // FDA Regulatory Services
    'fda regulatory': '/images/services/FDA Regulatory Testing.jpg',
    'fda': '/images/services/FDA Regulatory Testing.jpg',
    
    // DCB Services
    'dcb': '/images/services/Comprehensive DCB Validation.jpg',
    'drug-coated balloon': '/images/services/Comprehensive DCB Validation.jpg',
    'comprehensive dcb': '/images/services/Comprehensive DCB Validation.jpg',
  };
  
  // Check headline first
  for (const [key, imagePath] of Object.entries(imageMap)) {
    if (headlineLower.includes(key)) {
      return imagePath;
    }
  }
  
  // Check slug as fallback
  for (const [key, imagePath] of Object.entries(imageMap)) {
    if (slugLower.includes(key)) {
      return imagePath;
    }
  }
  
  // Default placeholder
  return '/images/placeholder.jpg';
}

const { page } = Astro.props;
// Construct full path for breadcrumbs: parentHubUrl + slug
const fullPath = page.parentHubUrl.replace('/preclinical-services/', '') + '/' + page.slug;
const breadcrumbs = getBreadcrumbs(fullPath);
const heroImage = getServiceHeroImage(page.heroHeadline, page.slug);
---

<BaseLayout title={page.title}>
  <HeroWithPhoto 
    headline={page.heroHeadline}
    description={page.heroDescription}
    breadcrumbs={breadcrumbs}
    imageUrl={heroImage}
  />
  <PrimaryContent 
    title={page.primaryContentTitle}
    description={page.primaryContentDescription}
    capabilitiesTitle={page.keyCapabilitiesTitle}
    capabilities={page.capabilities}
  />
  <WhyChoose 
    title={page.whyChooseTitle}
    cards={page.whyChooseCards}
  />
  <CTASection cta={page.cta} />
</BaseLayout>

