---
import BaseLayout from './BaseLayout.astro';
import HeroWithPhoto from '../components/sections/HeroWithPhoto.astro';
import PrimaryContent from '../components/sections/PrimaryContent.astro';
import WhyChoose from '../components/sections/WhyChoose.astro';
import CTASection from '../components/sections/CTASection.astro';
import type { ServicePage } from '../types/index.js';
import { getBreadcrumbs } from '../utils/dataLoader';

interface Props {
  page: ServicePage;
}

// Map service page headlines to unique image paths
// Each service page gets its own unique image based on heroHeadline
function getServiceHeroImage(headline: string, slug: string): string {
  // Use the exact heroHeadline format to map to image filename
  // Images are named: "{heroHeadline}.jpg"
  const imagePath = `/images/services/${headline}.jpg`;
  
  // Return the path - if image doesn't exist, browser will show broken image
  // or we can add fallback logic later if needed
  return imagePath;
}

const { page } = Astro.props;
// Construct full path for breadcrumbs: parentHubUrl + slug
const fullPath = page.parentHubUrl.replace('/preclinical-services/', '') + '/' + page.slug;
const breadcrumbs = getBreadcrumbs(fullPath);
const heroImage = getServiceHeroImage(page.heroHeadline, page.slug);
---

<BaseLayout title={page.title}>
  <HeroWithPhoto 
    headline={page.heroHeadline}
    description={page.heroDescription}
    breadcrumbs={breadcrumbs}
    imageUrl={heroImage}
  />
  <PrimaryContent 
    title={page.primaryContentTitle}
    description={page.primaryContentDescription}
    capabilitiesTitle={page.keyCapabilitiesTitle}
    capabilities={page.capabilities}
  />
  <WhyChoose 
    title={page.whyChooseTitle}
    cards={page.whyChooseCards}
  />
  <CTASection cta={page.cta} />
</BaseLayout>

