---
import BaseLayout from './BaseLayout.astro';
import HeroWithBreadcrumb from '../components/sections/HeroWithBreadcrumb.astro';
import SubServicesGrid from '../components/sections/SubServicesGrid.astro';
import PrimaryContent from '../components/sections/PrimaryContent.astro';
import WhyChoose from '../components/sections/WhyChoose.astro';
import CTASection from '../components/sections/CTASection.astro';
import type { ParentPage } from '../types/index.js';
import { getBreadcrumbs } from '../utils/dataLoader';

interface Props {
  page: ParentPage;
}

const { page } = Astro.props;
// Construct full path for breadcrumbs: parentHubUrl + slug
const fullPath = page.parentHubUrl.replace('/preclinical-services/', '') + '/' + page.slug;
const breadcrumbs = getBreadcrumbs(fullPath);

// Generate SEO-friendly description
const metaDescription = page.heroDescription || `${page.heroHeadline} - Comprehensive preclinical testing services at Synchrony Labs.`;
const pageUrl = `/preclinical-services/${fullPath}`;
---

<BaseLayout 
  title={page.title}
  description={metaDescription}
  url={pageUrl}
>
  <HeroWithBreadcrumb 
    headline={page.heroHeadline}
    description={page.heroDescription}
    breadcrumbs={breadcrumbs}
  />
  <SubServicesGrid 
    title={page.subServicesTitle}
    description={page.subServicesDescription}
    items={page.subServices}
  />
  <PrimaryContent 
    title={page.primaryContentTitle}
    description={page.primaryContentDescription}
    capabilitiesTitle={page.keyCapabilitiesTitle}
    capabilities={page.capabilities}
    pageTitle={page.heroHeadline}
  />
  <WhyChoose 
    title={page.whyChooseTitle}
    cards={page.whyChooseCards}
  />
  <CTASection cta={page.cta} />
</BaseLayout>

