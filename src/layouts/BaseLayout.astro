---
import Header from '../components/global/Header.astro';
import Footer from '../components/global/Footer.astro';
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  url?: string;
  type?: string;
}

const {
  title = 'Synchrony Labs - Specialized Cardiovascular Preclinical Research',
  description = 'Four decades of GLP expertise advancing structural heart, neurovascular, and peripheral vascular innovation.',
  image = '/images/placeholder.jpg',
  url = Astro.url.href,
  type = 'website',
} = Astro.props;

const siteUrl = import.meta.env.SITE_URL || 'https://synchronylabs.com';
const fullUrl = url.startsWith('http') ? url : `${siteUrl}${url}`;
const fullImageUrl = image.startsWith('http') ? image : `${siteUrl}${image}`;
---

<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    
    {/* Primary Meta Tags */}
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    
    {/* Open Graph / Facebook */}
    <meta property="og:type" content={type} />
    <meta property="og:url" content={fullUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={fullImageUrl} />
    <meta property="og:site_name" content="Synchrony Labs" />
    
    {/* Twitter */}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={fullUrl} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={fullImageUrl} />
    
    {/* Schema.org JSON-LD */}
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Synchrony Labs",
      "url": siteUrl,
      "logo": `${siteUrl}/logos/shi-sl_navy_horizontal.svg`,
      "description": description,
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "US"
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+1-919-541-9977",
        "contactType": "Sales",
        "email": "sales@synchronylabs.com"
      },
      "sameAs": []
    })} />
  </head>
  <body class="min-h-screen font-sans text-navy dark:text-white selection:bg-steel selection:text-white overflow-x-hidden relative transition-colors duration-500">
    
    {/* FIXED GLOBAL 3D BACKGROUND */}
    <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none bg-white dark:bg-black transition-colors duration-700">
      
      {/* Grid Pattern - Subtle Texture */}
      <div 
        class="absolute inset-0 z-0 opacity-[0.05] dark:opacity-[0.08]"
        style={{
          backgroundImage: `linear-gradient(to right, currentColor 1px, transparent 1px),
                            linear-gradient(to bottom, currentColor 1px, transparent 1px)`,
          backgroundSize: '80px 80px',
          maskImage: 'linear-gradient(to bottom, black 40%, transparent 95%)'
        }}
      ></div>

      {/* --- DARK MODE RAYS --- */}
      <div id="dark-mode-rays" class="absolute top-[-30vh] left-1/2 -translate-x-1/2 w-[160vw] h-[160vh] pointer-events-none z-10 mix-blend-screen perspective-1000 transition-opacity duration-1000 opacity-100">
        {/* Ray 1: Bright White Core */}
        <div class="absolute inset-0 animate-ray-drift-1 opacity-70 blur-[40px] transform-gpu" 
          style="background: conic-gradient(from 170deg at 50% 0%, transparent 0deg, rgba(255,255,255,0.1) 5deg, rgba(255,255,255,0.6) 10deg, rgba(255,255,255,0.1) 15deg, transparent 20deg)">
        </div>
        {/* Ray 2: Steel Blue Wide Beam */}
        <div class="absolute inset-0 animate-ray-drift-2 opacity-60 blur-[50px] transform-gpu" 
          style="background: conic-gradient(from 160deg at 50% 0%, transparent 0deg, rgba(176,196,222,0.1) 10deg, rgba(176,196,222,0.4) 20deg, rgba(176,196,222,0.1) 30deg, transparent 40deg)">
        </div>
        {/* Ray 3: Light Steel Blue / White Mix */}
        <div class="absolute inset-0 animate-ray-drift-3 opacity-60 blur-[30px] transform-gpu" 
          style="background: conic-gradient(from 175deg at 50% 0%, transparent 0deg, rgba(255,255,255,0.1) 2deg, rgba(255,255,255,0.7) 5deg, rgba(255,255,255,0.1) 8deg, transparent 10deg)">
        </div>
        {/* Ray 4: Ambient Wide Wash */}
        <div class="absolute inset-0 animate-ray-flash opacity-40 blur-[80px] transform-gpu" 
          style="background: conic-gradient(from 140deg at 50% 0%, transparent 0deg, rgba(70,130,180,0.2) 40deg, transparent 80deg)">
        </div>
        {/* Ray 5: Sharp White Highlight */}
        <div class="absolute inset-0 animate-pulse-slow opacity-30 blur-[20px] transform-gpu" 
          style="background: conic-gradient(from 178deg at 50% 0%, transparent 0deg, rgba(255,255,255,0.5) 2deg, transparent 4deg)">
        </div>
      </div>

      {/* --- LIGHT MODE RAYS (Light Blue Beams) --- */}
      <div id="light-mode-rays" class="absolute top-[-30vh] left-1/2 -translate-x-1/2 w-[160vw] h-[160vh] pointer-events-none z-10 perspective-1000 transition-opacity duration-1000 opacity-0">
        {/* Ray 1: Steel Blue Core (Darker than white background) */}
        <div class="absolute inset-0 animate-ray-drift-1 opacity-40 blur-[50px] transform-gpu" 
          style="background: conic-gradient(from 170deg at 50% 0%, transparent 0deg, rgba(70,130,180,0.05) 5deg, rgba(70,130,180,0.5) 10deg, rgba(70,130,180,0.05) 15deg, transparent 20deg)">
        </div>
        {/* Ray 2: Light Blue/Teal Wide Beam */}
        <div class="absolute inset-0 animate-ray-drift-2 opacity-50 blur-[60px] transform-gpu" 
          style="background: conic-gradient(from 160deg at 50% 0%, transparent 0deg, rgba(173,216,230,0.1) 10deg, rgba(70,130,180,0.3) 20deg, rgba(173,216,230,0.1) 30deg, transparent 40deg)">
        </div>
        {/* Ray 3: Sharp Steel Highlight */}
        <div class="absolute inset-0 animate-ray-drift-3 opacity-30 blur-[30px] transform-gpu" 
          style="background: conic-gradient(from 175deg at 50% 0%, transparent 0deg, rgba(70,130,180,0.1) 2deg, rgba(30,60,90,0.2) 5deg, rgba(70,130,180,0.1) 8deg, transparent 10deg)">
        </div>
      </div>

      {/* Top Light Source Glow */}
      <div class="absolute top-[-150px] left-1/2 -translate-x-1/2 w-[80vw] h-[40vh] blur-[80px] pointer-events-none transition-colors duration-1000 bg-[radial-gradient(ellipse_at_center,rgba(176,196,222,0.5)_0%,transparent_70%)] dark:bg-[radial-gradient(ellipse_at_center,rgba(176,196,222,0.3)_0%,transparent_70%)]"></div>

      {/* Bottom Vignette */}
      <div class="absolute inset-0 pointer-events-none transition-colors duration-1000 bg-[radial-gradient(circle_at_center,transparent_20%,rgba(255,255,255,0.8)_100%)] dark:bg-[radial-gradient(circle_at_center,transparent_20%,rgba(0,0,0,0.8)_100%)]"></div>
      
      {/* Subtle Glowing Particles */}
      <div id="particles-container" class="absolute inset-0 pointer-events-none z-5 opacity-40 dark:opacity-30"></div>
    </div>

    {/* SCROLLABLE CONTENT */}
    <div class="relative z-10 flex flex-col min-h-screen">
      <Header />
      <main class="flex-grow max-w-[1440px] mx-auto w-full">
        <slot />
      </main>
      <Footer />
    </div>

    <script>
      // Initialize theme on page load
      function initTheme() {
        const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'dark');
        document.documentElement.classList.toggle('dark', theme === 'dark');
        updateRayVisibility(theme === 'dark');
      }

      function updateRayVisibility(isDark: boolean) {
        const darkRays = document.getElementById('dark-mode-rays');
        const lightRays = document.getElementById('light-mode-rays');
        if (darkRays && lightRays) {
          darkRays.classList.toggle('opacity-100', isDark);
          darkRays.classList.toggle('opacity-0', !isDark);
          lightRays.classList.toggle('opacity-100', !isDark);
          lightRays.classList.toggle('opacity-0', isDark);
        }
      }

      // Watch for theme changes
      const observer = new MutationObserver(() => {
        const isDark = document.documentElement.classList.contains('dark');
        updateRayVisibility(isDark);
      });

      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });

      // Initialize
      initTheme();
      
      // Subtle glowing particle effect
      function createParticles() {
        const container = document.getElementById('particles-container');
        if (!container) return;
        
        // Clear any existing particles
        container.innerHTML = '';
        
        const particleCount = 20;
        
        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('div');
          const size = Math.random() * 6 + 4; // 4-10px
          const x = Math.random() * 100; // 0-100%
          const y = Math.random() * 100; // 0-100%
          const duration = Math.random() * 30 + 40; // 40-70s (very slow)
          const delay = Math.random() * 10; // 0-10s
          
          particle.className = 'absolute rounded-full';
          particle.style.width = size + 'px';
          particle.style.height = size + 'px';
          particle.style.left = x + '%';
          particle.style.top = y + '%';
          particle.style.background = 'radial-gradient(circle, rgba(70,130,180,0.8) 0%, rgba(70,130,180,0.4) 50%, transparent 100%)';
          particle.style.boxShadow = '0 0 15px rgba(70,130,180,0.6), 0 0 30px rgba(70,130,180,0.3)';
          particle.style.animation = 'particleFloat ' + duration + 's ease-in-out infinite';
          particle.style.animationDelay = delay + 's';
          particle.style.filter = 'blur(0.5px)';
          particle.style.pointerEvents = 'none';
          
          container.appendChild(particle);
        }
      }
      
      // Wait for DOM to be ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', createParticles);
      } else {
        createParticles();
      }
    </script>
    
    <style>
      @keyframes particleFloat {
        0%, 100% {
          transform: translate(0, 0) scale(1);
          opacity: 0.5;
        }
        25% {
          transform: translate(30px, -40px) scale(1.3);
          opacity: 0.7;
        }
        50% {
          transform: translate(-20px, -60px) scale(0.8);
          opacity: 0.6;
        }
        75% {
          transform: translate(40px, -30px) scale(1.2);
          opacity: 0.8;
        }
      }
    </style>
  </body>
</html>

