---
import Logo from '../ui/Logo.astro';
import Navigation from './Navigation.astro';
import MobileMenu from './MobileMenu.astro';
---

<header 
  id="header"
  class="fixed top-0 z-50 w-full transition-all duration-300 bg-transparent"
>
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex h-20 items-center justify-between">
      <div class="flex-shrink-0">
        <a href="/">
          <Logo id="header-logo" theme="auto" />
        </a>
      </div>
      
      <Navigation />

      <div class="flex items-center gap-4 md:hidden">
        <button 
          id="mobile-theme-toggle"
          class="p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 text-navy dark:text-white transition-colors"
          aria-label="Toggle theme"
        >
          <span id="mobile-theme-icon-sun" class="hidden">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
          </span>
          <span id="mobile-theme-icon-moon" class="hidden">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </span>
        </button>
        <button 
          id="mobile-menu-button"
          class="p-2 text-navy dark:text-white hover:text-teal transition-colors"
          aria-label="Toggle menu"
          aria-expanded="false"
        >
          <span id="menu-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </span>
          <span id="close-icon" class="hidden">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </span>
        </button>
      </div>
    </div>
  </div>

  <MobileMenu />
</header>

<script>
  // Theme toggle for mobile
  function initMobileTheme() {
    const theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'dark');
    updateMobileThemeIcon(theme === 'dark');
  }

  function updateMobileThemeIcon(isDark: boolean) {
    const sunIcon = document.getElementById('mobile-theme-icon-sun');
    const moonIcon = document.getElementById('mobile-theme-icon-moon');
    if (sunIcon && moonIcon) {
      sunIcon.classList.toggle('hidden', !isDark);
      moonIcon.classList.toggle('hidden', isDark);
    }
  }

  function toggleMobileTheme() {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    updateMobileThemeIcon(isDark);
    
    // Also update desktop theme icons
    const desktopSun = document.getElementById('theme-icon-sun');
    const desktopMoon = document.getElementById('theme-icon-moon');
    if (desktopSun && desktopMoon) {
      desktopSun.classList.toggle('hidden', !isDark);
      desktopMoon.classList.toggle('hidden', isDark);
    }
  }

  // Mobile menu toggle
  function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const button = document.getElementById('mobile-menu-button');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    
    if (menu && button && menuIcon && closeIcon) {
      const isOpen = !menu.classList.contains('hidden');
      menu.classList.toggle('hidden', isOpen);
      menuIcon.classList.toggle('hidden', !isOpen);
      closeIcon.classList.toggle('hidden', isOpen);
      button.setAttribute('aria-expanded', String(!isOpen));
    }
  }

  // Scroll detection for header background
  function handleScroll() {
    const header = document.getElementById('header');
    if (header) {
      const isScrolled = window.scrollY > 10;
      header.className = isScrolled
        ? 'fixed top-0 z-50 w-full transition-all duration-300 bg-white/80 dark:bg-navy-dark/70 backdrop-blur-md border-b border-navy/5 dark:border-white/5 shadow-lg'
        : 'fixed top-0 z-50 w-full transition-all duration-300 bg-transparent';
    }
  }

  // Initialize
  initMobileTheme();

  // Event listeners
  const mobileThemeToggle = document.getElementById('mobile-theme-toggle');
  if (mobileThemeToggle) {
    mobileThemeToggle.addEventListener('click', toggleMobileTheme);
  }

  const mobileMenuButton = document.getElementById('mobile-menu-button');
  if (mobileMenuButton) {
    mobileMenuButton.addEventListener('click', toggleMobileMenu);
  }

  window.addEventListener('scroll', handleScroll);
  
  // Watch for theme changes
  const observer = new MutationObserver(() => {
    updateLogoTheme();
  });
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['class']
  });
</script>

